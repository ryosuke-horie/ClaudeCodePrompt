# Claude CodeのSub agentsでコンテキスト枯渇問題をサクッと解決できたはなし

## 記事情報
- **URL**: https://zenn.dev/tacoms/articles/552140c84aaefa
- **著者**: たこみ
- **種別**: 実践事例・問題解決
- **公開日**: 記事による

## 記事の概要
AIによる開発プロセスで頻発するコンテキスト枯渇（auto-compact）問題を、サブエージェントを活用して解決した実践例。タスク分解、実行、品質チェックを専門エージェントに分担させることで効率化を実現。

## 解決した課題

### 1. コンテキスト枯渇問題
- 長時間の開発作業でコンテキストが圧縮される
- auto-compactにより重要な情報が失われる
- 作業の継続性が損なわれる

### 2. 複雑なタスクの管理
- 大規模な実装の全体像が把握しづらい
- 進捗管理が困難
- 品質チェックが体系化されていない

## 実装したサブエージェント

### 1. task-decomposer（タスク分解エージェント）
```markdown
---
name: task-decomposer
description: 作業計画を1コミット単位のタスクに分解
---

以下のルールでタスクを分解：
- 1タスク = 1コミット
- 1-5ファイル程度の変更
- 独立してテスト可能な単位
- 明確な目的と成果物
```

### 2. task-executor（タスク実行エージェント）
```markdown
---
name: task-executor
description: タスクを実行し進捗を管理
---

タスク実行時の責務：
- 分解されたタスクを順次実行
- 進捗状況の報告
- エラー時の適切なフィードバック
- コミットメッセージの作成
```

### 3. quality-checker（品質チェックエージェント）
```markdown
---
name: quality-checker
description: 実装の品質チェックを実施
---

チェック項目：
- コーディング規約の遵守
- テストの網羅性
- パフォーマンスの考慮
- セキュリティの確認
```

## 着目点（なぜこの記事を共有したか）
- 実際の開発現場での具体的な問題解決例
- コンテキスト枯渇という共通の課題への対処法
- サブエージェントの実践的な活用パターン
- 改善効果が明確に示されている

## 実践可能な内容の抽出

### 1. エージェント配置
```
.claude/
└── agents/
    ├── task-decomposer.md
    ├── task-executor.md
    └── quality-checker.md
```

### 2. ワークフロー設計
```
1. 要件定義
   ↓
2. task-decomposer でタスク分解
   ↓
3. task-executor で順次実行
   ↓
4. quality-checker で品質確認
   ↓
5. フィードバックループ
```

### 3. タスク分解の基準
- **サイズ**: 1-5ファイルの変更
- **時間**: 30分以内で完了
- **独立性**: 他のタスクに依存しない
- **テスト可能**: 単独でテスト可能

### 4. 効果的な運用のポイント

#### 前提条件の整備
- 詳細なルールファイル（CLAUDE.md）
- 設計ドキュメントの充実
- プロジェクト構造の明確化

#### タスク記述の標準化
```markdown
## タスク: [タスク名]
### 目的
[何を達成するか]

### 変更対象
- ファイル1
- ファイル2

### 完了条件
- [ ] 実装完了
- [ ] テスト追加
- [ ] ドキュメント更新
```

### 5. 得られた成果
- **コンテキスト管理**: タスクごとに新しいコンテキストで作業
- **品質向上**: 体系的なチェックプロセス
- **透明性**: 進捗の可視化
- **効率化**: 並列作業の可能性

### 6. 注意点と制限事項
- サブエージェント間の直接呼び出しは未対応
- メインのClaude Codeが仲介役として必要
- 初期設定に時間がかかる
- チーム全体での運用ルール統一が必要

## 実践から得られた知見
1. **小さく分割**: タスクは可能な限り小さく
2. **明確な責務**: 各エージェントの役割を限定
3. **ドキュメント重視**: 前提知識の文書化が成功の鍵
4. **反復的改善**: 使いながらプロンプトを調整

この事例は、サブエージェントがコンテキスト管理の問題を実践的に解決できることを示す優れた例です。