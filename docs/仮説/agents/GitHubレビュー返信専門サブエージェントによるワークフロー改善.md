# GitHubレビュー返信専門サブエージェントによるワークフロー改善

## 仮説の概要
GitHub PRレビューへの返信処理に特化したサブエージェントを作成することで、現在110行にも及ぶ複雑なカスタムコマンドのワークフローを大幅に簡略化し、レビュー返信の忘れや認識ミスを防ぐことができる。

## 現状の課題

### 1. 複雑なワークフロー
現在の `/reply-review` コマンドは：
- MCP、GraphQL、REST APIの3つを組み合わせる必要
- リゾルブ状態の確認、修正、返信、テスト、コミットまで多段階
- 110行に及ぶ詳細な指示が必要

### 2. コンテキスト圧迫による問題
- **返信忘れ**: 指示があるにも関わらず、時々返信を忘れる
- **反復での劣化**: 3回程度レビューを往復すると返信すらしなくなる
- **認識ミス**: 「レビューがない」と誤認識することがある

### 3. リゾルブ状態の把握困難
- 未解決/解決済みの判定が不安定
- GraphQLクエリの結果を正しく解釈できないことがある

## プロンプトの書き方提案

### GitHubレビュー返信専門サブエージェント

```markdown
---
name: github-review-responder
description: Use PROACTIVELY for GitHub PR review comment responses and resolution tracking
tools: mcp__github__get_pull_request_comments, Bash, Read, Edit
---

# GitHub PRレビュー返信スペシャリスト

あなたはGitHub PRレビューコメントへの返信に特化したエージェントです。

## 専門知識
- GitHub API（REST/GraphQL）の深い理解
- レビューコメントのステータス管理
- インライン返信のベストプラクティス

## 基本ワークフロー
1. MCPでコメント取得
2. リゾルブ状態を正確に判定
3. 未解決コメントへの対応実施
4. 必ず各コメントに返信

## 返信フォーマット
```
対応しました：
- [具体的な変更内容]
- [該当コミット: abc123]
```

## 重要な原則
- すべての未解決コメントに必ず返信
- 返信なしでのプッシュは厳禁
- リゾルブ状態を常に追跡
```

## カスタムコマンドの活用案

### 簡略化されたreply-reviewコマンド

```markdown
---
description: レビューコメントへの対応と返信
argument-hint: <owner> <repo> <pull_number>
---

# レビューコメント対応

github-review-responderサブエージェントを使用して、
PRのレビューコメントに対応してください。

修正後は必ずテストを実行し、コミット・プッシュしてください。
```

### 期待される改善効果

| 項目 | 現状 | 改善後 |
|-----|-----|-------|
| コマンド記述量 | 110行 | 10行程度 |
| 返信忘れ | 頻発 | サブエージェントが確実に実行 |
| リゾルブ状態把握 | 不安定 | 専門化により正確 |
| 反復耐性 | 3回程度で劣化 | コンテキスト独立で安定 |

## フックの設定例

### レビュー自動応答フロー

```yaml
# .github/workflows/auto-review-response.yml
on:
  pull_request_review_comment:
    types: [created]

jobs:
  auto-respond:
    runs-on: ubuntu-latest
    steps:
      - uses: anthropics/claude-code-action@v1
        with:
          task: |
            /agent github-review-responder
            "PR #${{ github.event.pull_request.number }}のレビューに対応"
```

## 期待される効果

### 1. コンテキスト圧縮効果
- **削減率**: 90%以上（110行→10行）
- **独立性**: メインのコンテキストを汚染しない
- **再利用性**: 他のプロジェクトでも同じエージェントを使用可能

### 2. 品質向上
- **返信率**: 100%（忘れない）
- **正確性**: リゾルブ状態の正確な把握
- **一貫性**: 返信フォーマットの統一

### 3. 開発効率
- **時間短縮**: API呼び出しの最適化
- **エラー削減**: 専門化による精度向上
- **学習コスト**: シンプルなインターフェース

## 検証すべき項目

### 1. 実装検証
- サブエージェントが正しくMCPツールを使えるか
- GraphQLクエリの実行権限
- 返信APIの呼び出し成功率

### 2. パフォーマンス測定
- 処理時間の比較（現状 vs サブエージェント）
- メモリ使用量
- API呼び出し回数

### 3. 信頼性テスト
- 10回以上の連続レビューでの安定性
- 複数コメントの同時処理
- エラーハンドリング

## メモ

### 段階的移行計画
1. **Phase 1**: 基本的な返信機能の実装
2. **Phase 2**: リゾルブ状態管理の高度化
3. **Phase 3**: 自動修正提案機能の追加

### 他の応用可能性
- **issue-responder**: Issue対応専門
- **pr-merger**: マージ処理専門
- **release-noter**: リリースノート作成専門

### 注意点
- サブエージェントのMCPアクセス権限の確認
- GitHub APIレート制限への対応
- 組織のセキュリティポリシーとの整合性

## 結論
GitHubレビュー返信に特化したサブエージェントを作成することで、現在の複雑なワークフローを大幅に簡略化し、より確実で効率的なレビュー対応が可能になる。これは「サブエージェントを作るエージェント」機能の実践的な活用例となる。